import fitz  # PyMuPDF
import re

# 游늷 Ruta del archivo PDF (MODIFICA SEG칔N TU ARCHIVO)
archivo_pdf = r"D:\LIBROS\C칩mo ganar amigos e influir sobre las personas ( PDFDrive )\C칩mo ganar amigos e influir sobre las personas ( PDFDrive ).pdf"

# Cargar el PDF
pdf_document = fitz.open(archivo_pdf)

# Expresi칩n regular para detectar t칤tulos con palabras clave
regex_titulo = re.compile(
    r"^(PREFACIO|PARTE\s*\d+|CAP[I칈]TULO\s*\d+|SECCI[칍O]N\s*\d+|EP[I칈]LOGO|INTRODUCCI[칍O]N|CONCLUSI[칍O]N|RESUMEN|AP칄NDICE|OCHO OBJETIVOS|NUEVE SUGERENCIAS|C칍MO FUE ESCRITO|UN BREVE CAMINO HACIA LA DISTINCI칍N)",
    re.IGNORECASE
)

# 游늷 Par치metros de detecci칩n de t칤tulos
TAMANO_MINIMO_TITULO = 14  # Ajusta seg칰n el tama침o de letra del PDF
MARGEN_SUPERIOR = 200  # Detectar si el texto est치 en la parte superior de la p치gina
LONGITUD_MINIMA_TITULO = 10  # Evitar detectar palabras sueltas
LONGITUD_MAXIMA_TITULO = 60  # Evitar detectar p치rrafos largos como t칤tulos

# 游늷 Lista para almacenar los t칤tulos detectados
titulos_encontrados = []

# 游늷 Analizar cada p치gina del PDF
for pagina_num in range(len(pdf_document)):  
    pagina = pdf_document[pagina_num]
    bloques_texto = pagina.get_text("dict")["blocks"]  # Extraer bloques de texto con formato

    for bloque in bloques_texto:
        if "lines" in bloque:  # Verifica si hay l칤neas de texto en el bloque
            for linea in bloque["lines"]:
                for span in linea["spans"]:
                    texto = span["text"].strip()
                    tamano = span["size"]  # Tama침o de letra
                    fuente = span["font"]  # Tipo de fuente
                    y_pos = bloque["bbox"][1]  # Posici칩n vertical en la p치gina

                    # 游늷 Condiciones para detectar t칤tulos reales
                    es_mayusculas = texto.isupper()  # Verificar si todo est치 en may칰sculas
                    es_negrita = "bold" in fuente.lower()  # Verificar si es negrita
                    es_cercano_al_inicio = y_pos < MARGEN_SUPERIOR  # Verificar si est치 en la parte superior
                    es_titulo_claro = regex_titulo.match(texto)  # Verificar si es un t칤tulo conocido
                    es_suficientemente_largo = LONGITUD_MINIMA_TITULO <= len(texto) <= LONGITUD_MAXIMA_TITULO  # Evitar detectar frases largas

                    # 游늷 Aplicar reglas combinadas para minimizar falsos positivos
                    if (
                        (tamano > TAMANO_MINIMO_TITULO and es_negrita and es_suficientemente_largo) or
                        (es_titulo_claro) or
                        (es_mayusculas and es_negrita and es_suficientemente_largo and es_cercano_al_inicio)
                    ):
                        titulos_encontrados.append(texto)

# 游늷 Mostrar los t칤tulos detectados
print("\n游늷 **T칤tulos detectados:**\n")
for titulo in titulos_encontrados:
    print(titulo)
